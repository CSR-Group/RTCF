(this["webpackJsonpdsync-editor"]=this["webpackJsonpdsync-editor"]||[]).push([[0],{157:function(e,t,n){e.exports=n(356)},162:function(e,t,n){},222:function(e,t,n){},356:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(28),o=n.n(s),i=n(35),c=n(29),l=n(61),u=n(62),h=(n(162),n(136)),d=n.n(h),p=n(137),f=n.n(p),v=(n(221),n(367)),g=n(368),y=(n(222),new d.a),b=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(i.a)(this,n),a=t.call(this,e),console.log(e),a.state={sessionid:e.state.sessionid,object:e.state.object},a}return Object(c.a)(n,[{key:"getTextFromMap",value:function(e){try{console.log(e.get("textarea"));for(var t=e.get("textarea"),n=Object.keys(t).sort(),a="",r=0;r<n.length;r++)a+=t[n[r]],r<n.length-1&&(a+="\n");return a}catch(s){return console.log(s.message),""}}}]),Object(c.a)(n,[{key:"isNewInBetweenLine",value:function(e,t,n,a,r){if(r+1>=e.length||e.length!==n.length+1)return!1;for(var s=r+1,o=a;s<e.length&&o<n.length;){if(e[s]!==t[n[o]])return!1;s++,o++}return!0}},{key:"handleEditorChange",value:function(e){e.html;var t=e.text,n=this.state.object.get("textarea"),a=t.split("\n");console.log("prevstate: ",n),console.log("currstate: ",a);var r=Object.keys(n).sort();console.log("prevLineKeys: ",r);for(var s=0,o=0;o<a.length&&s<r.length;o++){var i=a[o],c=n[r[s]];console.log("currLine: ",i),console.log("prevLine: ",c),i!==c?this.isNewInBetweenLine(a,n,r,s,o)?(this.state.object.set("textarea",a[o],(parseFloat(r[s-1])+parseFloat(r[s]))/2),console.log("new inbetween line detected")):s+1<r.length&&i===n[r[s+1]]?(this.state.object.del("textarea",parseFloat(r[s])),console.log("delete inbetween line detected"),s+=2):(console.log("line change detected"),this.state.object.set("textarea",i,parseFloat(r[s])),s++):s++}for(var l=parseFloat(r[r.length-1]);o<a.length;)console.log("new line detected"),this.state.object.set("textarea",a[o],l+1),l+=1,o++}},{key:"render",value:function(){var e=this;console.log("Rendering editor"),console.log(this.state.object);var t=this.getTextFromMap(this.state.object);return r.a.createElement("div",{className:"mainpage"},r.a.createElement(v.a,null,r.a.createElement(v.a.Item,{header:!0},r.a.createElement(g.a,{as:"h1",color:"violet"},r.a.createElement(g.a.Content,null,"Dsynk Editor"))),r.a.createElement(v.a.Item,{name:"session-name"},this.state.sessionid)),r.a.createElement("div",{className:"editor"},r.a.createElement(f.a,{value:t,renderHTML:function(e){return y.render(e)},onChange:function(t){return e.handleEditorChange(t)},config:{view:{menu:!0,md:!0,html:!0,fullScreen:!0,hideMenu:!0},table:{maxRow:6,maxCol:6},syncScrollMode:["leftFollowRight","rightFollowLeft"]}})))}}]),n}(r.a.Component),m=n(370),k=n(357),w=n(371),x=n(365),j=n(10),E=n.n(j),O=n(19),S=new(n(146).Client);function V(e,t){return M.apply(this,arguments)}function M(){return(M=Object(O.a)(E.a.mark((function e(t,n){return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:S.brokerURL="ws://"+n+"/session",console.log("connecting.."),S.onConnect=function(e){console.log("connected.."),t()},S.onStompError=function(e){console.log("Broker reported error: "+e.headers.message),console.log("Additional details: "+e.body)},S.activate();case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e,t,n,a){return C.apply(this,arguments)}function C(){return(C=Object(O.a)(E.a.mark((function e(t,n,a,r){var s;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=JSON.stringify({topic:n,from:a,message:r}),console.log("sending event : "+s),e.next=4,J(t,(function(){return S.publish({destination:"/state/event",body:s})}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e,t,n,a,r){return I.apply(this,arguments)}function I(){return(I=Object(O.a)(E.a.mark((function e(t,n,a,r,s){var o;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("initialize state : "+r),o=JSON.stringify({topic:n,from:a,variables:r}),e.next=4,J(t,(function(){S.publish({destination:"/state/create",body:o}),S.subscribe(n,s)}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e,t,n,a,r,s){return L.apply(this,arguments)}function L(){return(L=Object(O.a)(E.a.mark((function e(t,n,a,r,s,o){return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,J(t,(function(){S.subscribe(r,s),S.subscribe(n,a);var e=JSON.stringify({topic:r,clientid:o});S.publish({destination:"/state/get",body:e})}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(e,t){return D.apply(this,arguments)}function D(){return(D=Object(O.a)(E.a.mark((function e(t,n){var a;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(S.connected){e.next=6;break}return a=function(){n()},e.next=4,V(a,t);case 4:e.next=7;break;case 6:n();case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var R={int64:"int64",str:"str",doc:"doc"},A=function(){function e(t,n,a,r,s){for(var o in Object(i.a)(this,e),this.intVars={},this.strVars={},this.docVars={},this.typeMap={},this.clientID=n,this.topic=a,this.dsynkHubHost=r,this.callback=s,t)t[o].type===R.int64&&(this.intVars[o]=t[o].value,this.typeMap[o]=R.int64),t[o].type===R.str&&(this.strVars[o]=t[o].value,this.typeMap[o]=R.str),t[o].type===R.doc&&(this.docVars[o]={"0.00000":t[o].value},this.typeMap[o]=R.doc)}return Object(c.a)(e,[{key:"del",value:function(e,t){var n;if(!(e in this.typeMap))throw"variable "+e+" does not exist";t=t.toFixed(5);var a=this.typeMap[e];e in this.docVars&&(delete this.docVars[e][t],n={type:R[a],key:e,line:t,delValue:"DELETE"}),N(this.dsynkHubHost,this.topic,this.clientID,n)}},{key:"set",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(!(e in this.typeMap))throw"variable "+e+" does not exist";var a,r=this.typeMap[e];n=n.toFixed(5),r===R.int64&&(this.intVars[e]=t,a={type:R[r],key:e,value:t.toString()}),r===R.str&&(this.strVars[e]=t,a={type:R[r],key:e,value:t}),r===R.doc&&(this.docVars[e][n]=t,a={type:R[r],key:e,line:n,value:t}),N(this.dsynkHubHost,this.topic,this.clientID,a)}},{key:"get",value:function(e){if(!(e in this.typeMap))throw"variable "+e+" does not exist";var t=this.typeMap[e];return t===R.int64?this.intVars[e]:t===R.str?this.strVars[e]:t===R.doc?this.docVars[e]:void 0}},{key:"handle",value:function(e){console.log("handle change:",e);var t=JSON.parse(e.body);if(t.from!==this.clientID){var n,a=t.message;if((n=a.key in this.typeMap?this.typeMap[a.key]:a.type)===R.int64&&(console.log("change state : "+a.key+" - "+a.value),this.intVars[a.key]=a.value),n===R.str&&(console.log("change state : "+a.key+" - "+a.value),this.strVars[a.key]=a.value),n===R.doc){console.log(a.line),console.log(this.docVars[a.key]);var r=parseFloat(a.line).toFixed(5);void 0==a.delValue?(console.log("change state : "+a.key+" - "+r+" - "+a.value),this.docVars[a.key][r]=a.value):(console.log("change state : "+a.key+" - delete ("+r+")"),console.log("deleting",this.docVars[a.key][r]),delete this.docVars[a.key][r])}this.callback()}}},{key:"buildState",value:function(e){var t=JSON.parse(e.body);for(var n in console.log(t),t.integers)n in this.typeMap||(this.intVars[n]=t.integers[n],this.typeMap[n]=R.int64,console.log("building state int: "+n+" = "+t.integers[n]));for(var n in t.strings)n in this.typeMap||(this.strVars[n]=t.strings[n],this.typeMap[n]=R.str,console.log("building state str: "+n+" = "+t.strings[n]));for(var n in t.docs)if(!(n in this.typeMap)){var a={};for(var r in t.docs[n])a[parseFloat(r).toFixed(5)]=t.docs[n][r];this.docVars[n]=a,this.typeMap[n]=R.doc,console.log("building state doc: "+n+" = "+t.docs[n])}console.log(this),this.callback()}}]),e}(),T=n(369),B=Object(T.a)(),z={},W={};function G(e){return K.apply(this,arguments)}function K(){return(K=Object(O.a)(E.a.mark((function e(t){var n,a,r;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"POST",redirect:"follow"},e.prev=1,e.next=4,fetch("http://"+t+"/session",n);case 4:return a=e.sent,e.next=7,a.json();case 7:return r=e.sent,z[r.id]=r,e.abrupt("return",r);case 12:throw e.prev=12,e.t0=e.catch(1),e.t0;case 15:case"end":return e.stop()}}),e,null,[[1,12]])})))).apply(this,arguments)}function P(){return(P=Object(O.a)(E.a.mark((function e(t,n,a){var r,s,o,i;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G(t);case 2:return r=e.sent,s=r.hub.ip+":"+r.hub.port,o=new A(n,B,r.topic,s,a),i=r.topic,F(s,i,B,n,(function(e){return o.handle(e)})),W[r.id]=o,e.abrupt("return",[o,r.id]);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e,t){return $.apply(this,arguments)}function $(){return($=Object(O.a)(E.a.mark((function e(t,n){var a,r,s;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={method:"GET",redirect:"follow"},e.prev=1,e.next=4,fetch("http://"+t+"/session?id="+n,a);case 4:return r=e.sent,e.next=7,r.json();case 7:return s=e.sent,z[s.id]=s,e.abrupt("return",s);case 12:throw e.prev=12,e.t0=e.catch(1),e.t0;case 15:case"end":return e.stop()}}),e,null,[[1,12]])})))).apply(this,arguments)}function q(){return(q=Object(O.a)(E.a.mark((function e(t,n,a){var r,s,o;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n in z){e.next=6;break}return e.next=3,U(t,n);case 3:r=e.sent,e.next=7;break;case 6:r=z[n];case 7:return s=r.hub.ip+":"+r.hub.port,o=new A({},B,r.topic,s,a),W[r.id]=o,H(s,"/topic/client/"+B,(function(e){return o.buildState(e)}),r.topic,(function(e){return o.handle(e)}),B),e.abrupt("return",o);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Q=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={},a.sessionId="",a}return Object(c.a)(n,[{key:"handleStateChange",value:function(e){var t=this;e.setState((function(e){return{object:e.object,sessionid:t.sessionId}}))}},{key:"createNewSession",value:function(){var e=this;(function(e,t,n){return P.apply(this,arguments)})("dsynkmanager.eastus.azurecontainer.io:9090",{document:{type:"str",value:"Hello world"},textarea:{type:"doc",value:"Hello world"}},(function(){return e.handleStateChange(e)})).then((function(t){e.setState((function(e){return{object:t[0],sessionid:t[1]}}))}))}},{key:"joinSession",value:function(){var e=this;(function(e,t,n){return q.apply(this,arguments)})("dsynkmanager.eastus.azurecontainer.io:9090",this.sessionId,(function(){return e.handleStateChange(e)})).then((function(t){e.setState((function(n){return{object:t,sessionid:e.sessionId}}))}))}},{key:"render",value:function(){var e=this;return void 0==this.state.sessionid?r.a.createElement("div",{className:"App"},r.a.createElement("div",{className:"App-header"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"column"},r.a.createElement("div",{className:"ui text container inverted segment "},r.a.createElement(m.a,{verticalAlign:"middle",columns:1,centered:!0},r.a.createElement(m.a.Row,null,r.a.createElement(g.a,{inverted:!0,as:"h1",icon:!0,textAlign:"center",color:"violet"},r.a.createElement(g.a.Content,null,"Dsynk Editor"))),r.a.createElement(m.a.Row,null,r.a.createElement(k.a,{onClick:function(){return e.createNewSession()}},"Create New Session")),r.a.createElement(m.a.Row,null,r.a.createElement(w.a,{inverted:!0},r.a.createElement(x.a,{inverted:!0,action:{content:"Join",onClick:function(){return e.joinSession()}},placeholder:"Session id...",onChange:function(t){return e.sessionId=t.target.value}}))))))))):r.a.createElement("div",{className:"App"},r.a.createElement(b,{state:this.state}))}}]),n}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(355);o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(Q,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[157,1,2]]]);
//# sourceMappingURL=main.394dd44e.chunk.js.map